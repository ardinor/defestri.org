<!DOCTYPE HTML>
<html>
    <head>
        <title>Revisiting the auth log</title>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <link href='//fonts.googleapis.com/css?family=Ubuntu+Mono|Ubuntu' rel='stylesheet' type='text/css'>
        
        <!--[if lte IE 8]><script src="/static/js/html5shiv.js"></script><![endif]-->
        
        
        <script type="text/javascript" src="/static/js/moment.min.js"></script>
        
        
        <link rel="stylesheet" href="/static/css/skel-noscript.css" type="text/css">
        
        <link rel="stylesheet" href="/static/css/style.css" type="text/css">
        
        <link rel="stylesheet" href="/static/css/style-wide.css" type="text/css">
        
        <link rel="stylesheet" href="/pygments.css" type="text/css">
        
        <!--[if lte IE 9]><link rel="stylesheet" href="/static/css/ie9.css" /><![endif]-->
        
        
        <!--[if lte IE 8]><link rel="stylesheet" href="/static/css/ie8.css" /><![endif]-->
        
        <link rel="shortcut icon" type="image/png" href="static/favicon.ico"/>
        <link href="/recent.atom"
          rel="alternate"
          title="Recent Posts"
          type="application/atom+xml">
    </head>
    <body>

            <div id="header" class="skel-panels-fixed">

                <div class="top">

                        <div id="logo">
                            <a href="/"><h1 id="title">Defestri  <img src="/static/img/defestri.png" width="20" height="22" width="24" alt="Defestri"></h1></a>
                            <span title="It often takes time to bear the fruit of one's actions" class="byline">桃栗三年柿八年</span>
                        </div>

                        <nav id="nav">
                            <ul>
                                <li><a href="/" id="home_tab"><span class="fa fa-home">Home</span></a></li>
                                <li><a href="/about/" id="about_tab"><span class="fa fa-info">About</span></a></li>
                                <li><a href="/posts/" id="posts_tab"><span class="fa fa-comment-o">Posts</span></a></li>
                                <li><a href="/tags/" id="tags_tab"><span class="fa fa-tags">Tags</span></a></li>
                                <li><a href="/archive/" id="archive_tab"><span class="fa fa-calendar">Archive</span></a></li>
                            </ul>
                            <ul>

                                <li><a href="/categories/" id="categories_tab"><span class="fa fa-level-down"><h4>Post Categories</h4></span></a></li>
                                
                                <li>
                                  <a href="/categories/Security/" id="Security_tab"><span class="fa fa-folder-open">Security</span></a>
                                </li>
                                

                            </ul>
                        </nav>

                </div>

                <div class="bottom">

                        <ul class="icons">
                            <li><a href="https://github.com/ardinor" class="fa fa-github solo"><span>Github</span></a></li>
                            <li id="contact_tab"><a href="/contact/" class="fa fa-envelope solo"><span>Email</span></a></li>
                            <li><a href="/recent.atom" class="fa fa-rss solo"><span>RSS</span></a></li>
                        </ul>

                </div>

            </div>

            <div id="main">

                

    
<section id="posts" class="one">
    <div class="container">

        <header>
            <a href="/posts/Revisiting_the_auth_log/"><h2 style="display: inline;">Revisiting the auth log</h2></a>

        
            <span style="padding-top: 10px;" class="pull-right">Posted under: <a href="/categories/Security/">Security</a></span>
        
        </header>

        Posted by <a href="/about/">Jordan</a> on <script>
document.write(moment("2013-12-03T01:43:24 Z").format("LLLL"));
</script> - <em><script>
document.write(moment("2013-12-03T01:43:24 Z").fromNow());
</script></em>
        
            <span class="pull-right">Tagged: <a href="/tags/SSH/">SSH</a>, <a href="/tags/fail2ban/">fail2ban</a></span>
        

        <p><p>After about a month since my last update let's check our logs and see how the slightly stricter security measures are holding up.</p>
<div class="codehilite"><pre><span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">43</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26001</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">administraator</span> <span class="n">from</span> <span class="mf">217.153.86.163</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">43</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26003</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">administrador</span> <span class="n">from</span> <span class="mf">217.153.86.163</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">44</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26005</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">administranto</span> <span class="n">from</span> <span class="mf">217.153.86.163</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">44</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26007</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">administrate</span> <span class="n">from</span> <span class="mf">217.153.86.163</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">45</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26009</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">administrateur</span> <span class="n">from</span> <span class="mf">217.153.86.163</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">43</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26261</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">lukas</span> <span class="n">from</span> <span class="mf">198.61.179.140</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">44</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26263</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">ottomar</span> <span class="n">from</span> <span class="mf">198.61.179.140</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">45</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26265</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">pankraz</span> <span class="n">from</span> <span class="mf">198.61.179.140</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">46</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">26267</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">lucas</span> <span class="n">from</span> <span class="mf">198.61.179.140</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mo">05</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">27794</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">pomelnic</span> <span class="n">from</span> <span class="mf">184.106.189.106</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">51</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">27854</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">ram</span> <span class="n">from</span> <span class="mf">184.106.189.106</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">20</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">52</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">27856</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">jake</span> <span class="n">from</span> <span class="mf">184.106.189.106</span>
<span class="n">Dec</span>  <span class="mi">2</span> <span class="mi">21</span><span class="o">:</span><span class="mi">09</span><span class="o">:</span><span class="mi">22</span> <span class="n">defestri</span> <span class="n">sshd</span><span class="p">[</span><span class="mi">27868</span><span class="p">]</span><span class="o">:</span> <span class="n">Invalid</span> <span class="n">user</span> <span class="n">admin</span> <span class="n">from</span> <span class="mf">64.235.53.4</span>
</pre></div>


<p>As we can see there's still plenty of log in attempts coming in, although slightly less than last time. We can see how fail2ban is going by having a quick look at it's log.</p>
<div class="codehilite"><pre><span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">11</span><span class="o">:</span><span class="mi">28</span><span class="o">:</span><span class="mi">45</span><span class="p">,</span><span class="mi">147</span> <span class="n">fail2ban</span><span class="p">.</span><span class="n">actions</span><span class="o">:</span> <span class="n">WARNING</span> <span class="p">[</span><span class="n">ssh</span><span class="p">]</span> <span class="n">Ban</span> <span class="mf">217.153.86.163</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">31</span><span class="o">:</span><span class="mi">46</span><span class="p">,</span><span class="mi">725</span> <span class="n">fail2ban</span><span class="p">.</span><span class="n">actions</span><span class="o">:</span> <span class="n">WARNING</span> <span class="p">[</span><span class="n">ssh</span><span class="p">]</span> <span class="n">Ban</span> <span class="mf">198.61.179.140</span>
<span class="mi">2013</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mo">02</span> <span class="mi">20</span><span class="o">:</span><span class="mi">56</span><span class="o">:</span><span class="mi">53</span><span class="p">,</span><span class="mi">357</span> <span class="n">fail2ban</span><span class="p">.</span><span class="n">actions</span><span class="o">:</span> <span class="n">WARNING</span> <span class="p">[</span><span class="n">ssh</span><span class="p">]</span> <span class="n">Ban</span> <span class="mf">184.106.189.106</span>
</pre></div>


<p>So we can see it has successfully banned the three IPs that have attempted to break in three or more times in the log.</p>
<p>Out of curiousity I've written a parser to parse the auth.log and fail2ban.log and see not only the IPs (and the countries) these attempts are coming from but also the usernames they're trying to log in with. The files are up on my Github <a href="https://github.com/ardinor/misc/tree/master/auth-log%20parser">here</a> and the results of the parser are <a href="https://defestri.org/bans/">here</a>.</p>
<p>The auth-log parser script basically looks through the log, pulling out attempts for the last month, checks the location of the attempts using <a href="http://www.ipinfodb.com/">ipinfodb's</a> API then uses <a href="http://jinja.pocoo.org/docs/">jinja2</a> to output it into a HTML file.</p>
<p>From here I'd like to get the auth-log parser to run as a cron job every month, parse the log in attempts from the previous month and output it to a page visable on this site. On the side of security however, next up I think I'll get fail2ban to monitor it's own log, banning people who have been banned multiple times before. Then we should hopefully have a more secure server.</p></p>


    </div>
</section>




            </div>
    
    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    
    <script type="text/javascript" src="/static/js/skel.min.js"></script>
    
    <script type="text/javascript" src="/static/js/skel-panels.min.js"></script>
    
    <script type="text/javascript" src="/static/js/init.js"></script>
    
    <script type="text/javascript" src="/static/js/mojibake.js"></script>
    
    
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-46303127-1', 'defestri.org');
  ga('send', 'pageview');
    </script>
    
    </body>
</html>